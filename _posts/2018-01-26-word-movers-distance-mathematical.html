---
layout: post
title: 'Word Mover''s Distance: Mathematical Background'
date: '2018-01-26T20:02:00.001-08:00'
author: Sujay S Kumar
tags: 
modified_time: '2018-02-11T08:35:12.308-08:00'
blogger_id: tag:blogger.com,1999:blog-925060870564624560.post-2447877304108304122
blogger_orig_url: http://sujayskumar.blogspot.com/2018/01/word-movers-distance-mathematical.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">We are fully aware of the marked influence of the introduction of Word2Vec method of word embedding on the Natural Language Processing domain. It was a huge leap forward from the hitherto constricting method of word embeddings namely, Term Frequency (TF) and Inverse Document Frequency (IDF). Neither of these methods were anywhere close to preserving the semantics of the words in their representations. With the introduction of Word2Vec and the possibility of semantic embedding in the vectors, various avenues were thrown open where this representation could be exploited for various NLP applications.<br /><br />One of the logical extensions to Word2Vec was document similarity. Now that you could find out similarity between words, what was the best way of classifying or clustering documents semantically? There are two metrics by which we can quantify the similarity between two words, cosine similarity and Euclidean distance.<br /><br /><b>Word Mover's Distance (WMD)</b> was introduced in 2015 which leveraged Euclidean distance in order to quantify similarity between documents. WMD accomplishes this by quantifying the amount of distance that the embedded vectors in a document needs to travel in order to match the embedded vectors in another document, thereby offering us a proxy which quantifies dissimilarity (or similarity) between two documents. You can find a link to the original paper <a href="http://proceedings.mlr.press/v37/kusnerb15.pdf" target="_blank">here</a>.<br /><br />For example, let us consider three documents,<br /><br />D1: "<i><u>Obama</u> <u>speaks </u>to the <u>media</u> in <u>Illinois</u></i>"<br />D2: "<i>The <u>President</u> <u>greets </u>the <u>press</u> in <u>Chicago</u></i>"<br />D3: "<i><u>Obama</u> <u>speaks</u> in <u>Illinois</u></i>" <br /><br />WMD algorithm can be described in the following steps.<br /><br /><ul style="text-align: left;"><li>Each word in a sentence can be represented as a point in the <i>(n-1)</i> dimensional simplex of word distribution. The magnitude of the vector is represented by it's nBOW (n Bag Of Words) representation. Mathematically, if the word <i>i </i>appears <i>c<sub>i</sub> </i>times it can represented as,&nbsp; <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=d_{i}&amp;space;=&amp;space;\frac{c_{i}}{\sum_{j=1}^{n}c_{j}}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?d_{i}&amp;space;=&amp;space;\frac{c_{i}}{\sum_{j=1}^{n}c_{j}}" title="d_{i} = \frac{c_{i}}{\sum_{j=1}^{n}c_{j}}" /></a><br /><br />where <i>di&nbsp; </i>is a vector in <i>n </i>dimensional space specified by vocabulary size. It is perfectly clear from the above description that each word pair, if they are dissimilar, lie in a completely different plane irrespective of their semantic distance.</li><li>In the example considered above, after stop words removal, the nBOW representations of documents D1 and D2 have zero common non zero elements and hence lie in the max distance possible from each other even though semantically these sentences are close.</li><li>The distance metric used between any word pair is given by the Euclidean distance between the Word2Vec vectors. We will denote this distance between the word <i>i</i> and word <i>j</i> as  <br /><br /><i>c(i , j) = || x<sub>i</sub> - x<sub>j</sub> ||</i>,  <br /><br />where <i>c(i , j)</i> is the traveling cost from word <i>i</i> to word <i>j</i>.</li><li>The objective of the WMD algorithm is to calculate the flow matrix <i>T</i>. Flow matrix <i>T</i> can be defined as a sparse matrix of dimension <i>n X n.</i>  <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=T&amp;space;\in&amp;space;R^{n&amp;space;X&amp;space;n}&amp;space;\hspace{0.2cm}where&amp;space;\hspace{0.2cm}&amp;space;T_{i,j}\geq&amp;space;0" target="_blank"><img src="https://latex.codecogs.com/gif.latex?T&amp;space;\in&amp;space;R^{n&amp;space;X&amp;space;n}&amp;space;\hspace{0.2cm}where&amp;space;\hspace{0.2cm}&amp;space;T_{i,j}\geq&amp;space;0" title="T \in R^{n X n} \hspace{0.2cm}where \hspace{0.2cm} T_{i,j}\geq 0" /></a><br /><br />In the flow matrix <i>T</i>, <i>T<sub>i,j</sub></i> denotes how much of word <i>i</i> in <i>d</i> flows into word <i>j</i> in <i>d'</i>. Naturally, the sum of the outgoing flow from word <i>i</i> should be equal to <i>d<sub>i</sub></i> and the sum of the incoming flow to word <i>j</i> should be equal to <i>d'<sub>j</sub></i>. Mathematically,  <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{j}&amp;space;T_{i,j}&amp;space;=&amp;space;d_{i}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{j}&amp;space;T_{i,j}&amp;space;=&amp;space;d_{i}" title="\sum_{j} T_{i,j} = d_{i}" /></a><br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{i}&amp;space;T_{i,j}&amp;space;=&amp;space;d%27_{j}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{i}&amp;space;T_{i,j}&amp;space;=&amp;space;d'_{j}" title="\sum_{i} T_{i,j} = d'_{j}" /></a><br /><br /></li><li>Finally, we can calculate the distance between the two documents <i>d</i> and <i>d'</i> by calculating the minimum cumulative cost required to move all words in <i>d</i> to <i>d'</i>.  <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{i,j}&amp;space;T_{i,j}c(i,j)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{i,j}&amp;space;T_{i,j}c(i,j)" title="\sum_{i,j} T_{i,j}c(i,j)" /></a><br /><br /></li><li>The minimum cumulative cost can be formalized with constraints as follows,&nbsp;  <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\underset{T\geq&amp;space;0}{min}\sum_{i,j}&amp;space;T_{i,j}c(i,j)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\underset{T\geq&amp;space;0}{min}\sum_{i,j}&amp;space;T_{i,j}c(i,j)" title="\underset{T\geq 0}{min}\sum_{i,j} T_{i,j}c(i,j)" /></a><br /><br />subject to  <br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{j}&amp;space;T_{i,j}&amp;space;=&amp;space;d_{i}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{j}&amp;space;T_{i,j}&amp;space;=&amp;space;d_{i}" title="\sum_{j} T_{i,j} = d_{i}" /></a><br /><br /><a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{i}&amp;space;T_{i,j}&amp;space;=&amp;space;d%27_{j}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{i}&amp;space;T_{i,j}&amp;space;=&amp;space;d'_{j}" title="\sum_{i} T_{i,j} = d'_{j}" /></a><br /><br /></li><li>The solution to the above problem is a variation of the Transportation Problem called Earth Mover's Distance which can be found <a href="https://en.wikipedia.org/wiki/Earth_mover%27s_distance" target="_blank">here</a>.</li></ul>Although the algorithm seems simple enough when the number of words in the 2 documents are equal, complications arise when the number of words are different, as in the case between D2 and D3. In that case, the computational complexity increases to <i>O(P<sup>4</sup>)</i>. Hence, this algorithm is computationally very expensive.<br /><ul style="text-align: left;"></ul></div>